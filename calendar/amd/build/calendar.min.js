define(["jquery","core/ajax","core/str","core/templates","core/notification","core/custom_interaction_events","core/modal_factory","core_calendar/summary_modal","core_calendar/calendar_repository"],function(a,b,c,d,e,f,g,h,i){var j={ROOT:"[data-region='calendar']",EVENT_LINK:"[data-action='view-event']"},k=null,l=function(a){var b="type"+a;return c.get_string(b,"core_calendar").then(function(a){return a})},m=function(a){return c.get_string("subsource","core_calendar",a).then(function(b){return a.url?'<a href="'+a.url+'">'+b+"</a>":b})},n=function(b){var c=i.getEventById(b);return c.then(function(a){return a.event?a.event:void c.fail(e.exception)}).then(function(a){var b=l(a.eventtype);return b.then(function(c){return c?(a.eventtype=c,a):void b.fail(e.exception)})}).then(function(b){if(1==b.displayeventsource){b.subscription=JSON.parse(b.subscription);var c=m({url:b.subscription.url,name:b.subscription.name});c?(a.Deferred().resolve(),c.done(function(a){b.source=a})):c.fail(e.exception)}return k.done(function(a){a.setTitle(b.name),a.setBody(d.render("core_calendar/event_summary_body",b)),0==b.caneditevent&&a.setFooter(""),a.show()})})},o=function(b){b=a(b);var c=!1;b.on("click",j.EVENT_LINK,function(b){if(!c){c=!0,b.preventDefault();var d=a(b.target).closest(j.EVENT_LINK),f=d.attr("data-event-id");n(f).done(function(){c=!1}).fail(e.exception)}})};return{init:function(){k=g.create({type:h.TYPE}),o(j.ROOT)}}});