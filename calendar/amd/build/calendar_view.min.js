define(["jquery","core/str","core/notification","core_calendar/selectors","core_calendar/events","core_calendar/view_manager","core_calendar/repository","core/modal_factory","core_calendar/modal_event_form","core/modal_events","core_calendar/modal_delete"],function(a,b,c,d,e,f,g,h,i,j,k){function l(d,f,i){console.log(i);var l,m=[{key:"deleteevent",component:"calendar"}],n=i>1;n?(m.push({key:"confirmeventseriesdelete",component:"calendar",param:{name:f,count:i}}),l=h.create({type:k.TYPE},a('[data-action="delete"]'))):(m.push({key:"confirmeventdelete",component:"calendar",param:f}),l=h.create({type:h.types.SAVE_CANCEL},a('[data-action="delete"]')));var o=b.get_strings(m);a.when(o,l).then(function(b,f){return f.setTitle(b[0]),f.setBody(b[1]),n||f.setSaveButtonText(b[0]),f.getRoot().on(j.save,function(){g.deleteEvent(d,!1).then(function(){a("body").trigger(e.deleted,[d,!1])})["catch"](c.exception)}),f.getRoot().on(e.deleteAll,function(){g.deleteEvent(d,!0).then(function(){a("body").trigger(e.deleted,[d,!0])})["catch"](c.exception)}),f}).fail(c.exception)}var m=function(a,b){var c=b.data("context-id");return h.create({type:i.TYPE,large:!0,templateContext:{contextid:c}},[a,d.newEventButton])},n=function(b){var g=(a(d.deleteLink),a(d.newEventButton)),h=a("body"),i=1,j=m(b,g);b.on("click",d.editLink,function(b){b.preventDefault();var d=a(b.currentTarget);j.then(function(a){var b=d.data("event-id");b&&a.setEventId(b),a.show()}).fail(c.exception)}),b.on("click",d.deleteLink,function(b){b.preventDefault();var c=a(b.currentTarget),d=c.data("event-id"),e=c.data("title"),f=c.data("event-event-count");l(d,e,f)}),b.on("change",d.courseSelector,function(){var e=a(this),g=e.val();f.reloadCurrentUpcoming(b,g).then(function(){return b.find(d.courseSelector).val(g)}).fail(c.exception)}),h.on(e.created,function(){f.reloadCurrentUpcoming(b,i)}),h.on(e.updated,function(){f.reloadCurrentUpcoming(b,i)}),h.on(e.deleted,function(){f.reloadCurrentUpcoming(b,i)}),h.on(e.filterChanged,function(a,c){var e=b.find(d.eventType[c.type]);1==c.hidden?e.addClass("hidden"):e.removeClass("hidden")})};return{init:function(b){b=a(b),f.init(b),n(b)}}});