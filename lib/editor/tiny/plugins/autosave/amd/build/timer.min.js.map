{"version":3,"file":"timer.min.js","sources":["../src/timer.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Storage helper for the Moodle Tiny Autosave plugin.\n *\n * @module      tiny_autosave/plugin\n * @copyright   2022 Andrew Lyons <andrew@nicols.co.uk>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as Options from './options';\nimport * as Storage from './storage';\n\nexport default class {\n    /**\n     * Constructor for the Autosave plugin.\n     *\n     * @param {Editor} editor The editor instance this plugin is used in.\n     */\n    constructor(editor) {\n        this.editor = editor;\n        this.timer = null;\n    }\n\n    stop() {\n        if (this.timer) {\n            clearTimeout(this.timer);\n        }\n        this.timer = null;\n    }\n\n    shouldUpdateDraft() {\n        if (this.editor.dom.isEmpty(this.editor.getBody())) {\n            return false;\n        }\n\n        if (this.lastContent === this.editor.getContent()) {\n            return false;\n        }\n\n        return true;\n    }\n\n    async runTimer() {\n        if (!this.timer) {\n            return;\n        }\n\n        if (this.shouldUpdateDraft()) {\n            this.lastContent = this.editor.getContent();\n            await Storage.saveDraft(this.editor);\n        }\n\n        this.start();\n    }\n\n    start() {\n        this.timer = setTimeout(this.runTimer.bind(this), Options.getAutosaveFrequecy(this.editor));\n    }\n}\n"],"names":["constructor","editor","timer","stop","this","clearTimeout","shouldUpdateDraft","dom","isEmpty","getBody","lastContent","getContent","Storage","saveDraft","start","setTimeout","runTimer","bind","Options","getAutosaveFrequecy"],"mappings":";;;;;;;qMAgCIA,YAAYC,aACHA,OAASA,YACTC,MAAQ,KAGjBC,OACQC,KAAKF,OACLG,aAAaD,KAAKF,YAEjBA,MAAQ,KAGjBI,2BACQF,KAAKH,OAAOM,IAAIC,QAAQJ,KAAKH,OAAOQ,YAIpCL,KAAKM,cAAgBN,KAAKH,OAAOU,8BAQhCP,KAAKF,QAINE,KAAKE,2BACAI,YAAcN,KAAKH,OAAOU,mBACzBC,QAAQC,UAAUT,KAAKH,cAG5Ba,SAGTA,aACSZ,MAAQa,WAAWX,KAAKY,SAASC,KAAKb,MAAOc,QAAQC,oBAAoBf,KAAKH"}